<!DOCTYPE html>
<html lang=zh-CN>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta property="og:description" content="">
    <meta property="og:type" content="website">
    <meta name="description" content="">
    <meta name="keyword"  content="">
    <link rel="shortcut icon" href="/img/favicon.ico">

    <title>
        
        使用mac充电后一直震动红灯 - zddzdd
        
    </title>

    <!-- Custom CSS -->
    
<link rel="stylesheet" href="/css/aircloud.css">

    
<link rel="stylesheet" href="/css/gitment.css">

    <!--<link rel="stylesheet" href="https://imsun.github.io/gitment/style/default.css">-->
    <link href="//at.alicdn.com/t/font_620856_28hi1hpxx24.css" rel="stylesheet" type="text/css">
    <!-- ga & ba script hoook -->
    <script></script>

    









<meta name="generator" content="Hexo 7.1.1"><link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
</head>

<body>

<div class="site-nav-toggle" id="site-nav-toggle">
    <button>
        <span class="btn-bar"></span>
        <span class="btn-bar"></span>
        <span class="btn-bar"></span>
    </button>
</div>

<div class="index-about">
    <i>  </i>
</div>

<div class="index-container">
    
    <div class="index-left">
        
<div class="nav" id="nav">
    <div class="avatar-name">
        <div class="avatar ">
		<img src="/img/wanwan.jpg" class="js-avatar show"/>
	</div>
        <div class="name">
            <i>Xayahion</i>
        </div>
    </div>
    <div class="contents" id="nav-content">
        <ul>
            <li >
                <a href="/">
                    <i class="iconfont icon-shouye1"></i>
                    <span>主页</span>
                </a>
            </li>
            <li >
                <a href="/tags">
                    <i class="iconfont icon-biaoqian1"></i>
                    <span>标签</span>
                </a>
            </li>
            <li >
                <a href="/archives">
                    <i class="iconfont icon-guidang2"></i>
                    <span>存档</span>
                </a>
            </li>
            <li >
                <a href="/collect/">
                    <i class="iconfont icon-shoucang1"></i>
                    <span>收藏</span>
                </a>
            </li>
            <li >
                <a href="/about/">
                    <i class="iconfont icon-guanyu2"></i>
                    <span>关于</span>
                </a>
            </li>
            
        </ul>
    </div>
    
        <div id="toc" class="toc-article">
    <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%83%8C%E6%99%AF"><span class="toc-text">背景</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%97%A5%E5%BF%97"><span class="toc-text">日志</span></a></li></ol>
</div>
    
</div>


<div class="search-field" id="search-field">
    <div class="search-bg" id="search-bg"></div>
    <div class="search-container">
        <div class="search-input">
            <span id="esc-search"> <i class="icon-fanhui iconfont"></i></span>
            <input id="search-input"/>
            <span id="begin-search">搜索</span>
        </div>
        <div class="search-result-container" id="search-result-container">

        </div>
    </div>
</div>

        <div class="index-about-mobile">
            <i>  </i>
        </div>
    </div>
    
    <div class="index-middle">
        <!-- Main Content -->
        


<div class="post-container">
    <div class="post-title">
        使用mac充电后一直震动红灯
    </div>

    <div class="post-meta">
        <span class="attr">发布于：<span>2024-03-27 15:12:51</span></span>
        
        <span class="attr">标签：/
        
        <a class="tag" href="/tags/#problem" title="problem">problem</a>
        <span>/</span>
        
        
        </span>
        <span class="attr">访问：<span id="busuanzi_value_page_pv"></span>
</span>
</span>
    </div>
    <div class="post-content ">
        <h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><p>mac充电器充电（应该是插好的），早上来看电量没增加，插拔一次，震动了几下后红灯</p>
<h2 id="日志"><a href="#日志" class="headerlink" title="日志"></a>日志</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">[ <span class="number">3209.332272</span>] ---[ end trace c8d1c26a5a3e68b1 ]---</span><br><span class="line">[ <span class="number">3209.332286</span>] Unable to handle kernel <span class="literal">NULL</span> pointer dereference at virtual address <span class="number">0000000000000020</span></span><br><span class="line">[ <span class="number">3209.341529</span>] Mem <span class="built_in">abort</span> info:</span><br><span class="line">[ <span class="number">3209.344474</span>]   ESR = <span class="number">0x96000005</span></span><br><span class="line">[ <span class="number">3209.347662</span>]   Exception class = DABT (current EL), IL = <span class="number">32</span> bits</span><br><span class="line">[ <span class="number">3209.353795</span>]   SET = <span class="number">0</span>, FnV = <span class="number">0</span></span><br><span class="line">[ <span class="number">3209.357033</span>]   EA = <span class="number">0</span>, S1PTW = <span class="number">0</span></span><br><span class="line">[ <span class="number">3209.360358</span>] Data <span class="built_in">abort</span> info:</span><br><span class="line">[ <span class="number">3209.363410</span>]   ISV = <span class="number">0</span>, ISS = <span class="number">0x00000005</span></span><br><span class="line">[ <span class="number">3209.367457</span>]   CM = <span class="number">0</span>, WnR = <span class="number">0</span></span><br><span class="line">[ <span class="number">3209.370537</span>] user pgtable: <span class="number">4</span>k pages, <span class="number">39</span>-bit VAs, pgdp = <span class="number">000000000943e194</span></span><br><span class="line">[ <span class="number">3209.377427</span>] [<span class="number">0000000000000020</span>] pgd=<span class="number">0000000000000000</span>, pud=<span class="number">0000000000000000</span></span><br><span class="line">[ <span class="number">3209.384468</span>] Internal error: Oops: <span class="number">96000005</span> [#<span class="number">1</span>] PREEMPT SMP</span><br><span class="line">[ <span class="number">3209.390195</span>] Modules linked in: wlan(O) machine_dlkm(O) wcd938x_slave_dlkm(O) wcd938x_dlkm(O) wcd9xxx_dlkm(O) mbhc_dlkm(O) tx_macro_dlkm(O) rx_macro_dlkm(O) va_macro_dlkm(O) wsa_macro_dlkm(O) swr_ctrl_dlkm(O) bolero_cdc_dlkm(O) wsa881x_dlkm(O) wcd_core_dlkm(O) stub_dlkm(O) hdmi_dlkm(O) swr_dlkm(O) pinctrl_lpi_dlkm(O) pinctrl_wcd_dlkm(O) usf_dlkm(O) native_dlkm(O) platform_dlkm(O) q6_dlkm(O) adsp_loader_dlkm(O) apr_dlkm(O) snd_event_dlkm(O) q6_notifier_dlkm(O) q6_pdr_dlkm(O) msm_11ad_proxy</span><br><span class="line">[ <span class="number">3209.434453</span>] Process init (pid: <span class="number">1</span>, <span class="built_in">stack</span> limit = <span class="number">0x00000000aa1f60b5</span>)</span><br><span class="line">[ <span class="number">3209.440886</span>] CPU: <span class="number">4</span> PID: <span class="number">1</span> Comm: init Tainted: G S      W  O      <span class="number">4.19</span><span class="number">.157</span>-perf #<span class="number">1</span></span><br><span class="line">[ <span class="number">3209.448560</span>] Hardware name: Qualcomm Technologies, Inc. kona-xr-overlay Standalone (DT)</span><br><span class="line">[ <span class="number">3209.456681</span>] pstate: <span class="number">60400005</span> (nZCv daif +PAN -UAO)</span><br><span class="line">[ <span class="number">3209.461609</span>] pc : klist_del+<span class="number">0x20</span>/<span class="number">0x88</span></span><br><span class="line">[ <span class="number">3209.465292</span>] lr : device_del+<span class="number">0xa4</span>/<span class="number">0x4b0</span></span><br><span class="line">[ <span class="number">3209.469148</span>] sp : ffffff800805bb90</span><br><span class="line">[ <span class="number">3209.470791</span>] aw210xx_led <span class="number">1</span><span class="number">-0020</span>: usb: <span class="number">0</span>, pc_port: <span class="number">0</span></span><br><span class="line">[ <span class="number">3209.472558</span>] x29: ffffff800805bb90 x28: ffffffde408d9d80</span><br><span class="line">[ <span class="number">3209.472559</span>] x27: <span class="number">0000000000000000</span> x26: <span class="number">0000000000000000</span></span><br><span class="line">[ <span class="number">3209.472560</span>] x25: <span class="number">0000000056000000</span> x24: ffffffdfcc8254b8</span><br><span class="line">[ <span class="number">3209.472561</span>] x23: ffffffdfe99e2b20 x22: ffffffdfcc335008</span><br><span class="line">[ <span class="number">3209.472561</span>] x21: <span class="number">0000000000000000</span> x20: <span class="number">0000000000000000</span></span><br><span class="line">[ <span class="number">3209.472562</span>] x19: ffffffdf22ac2628 x18: <span class="number">000000000000004</span>c</span><br><span class="line">[ <span class="number">3209.472563</span>] x17: ffffff9313a66000 x16: <span class="number">0000000000000068</span></span><br><span class="line">[ <span class="number">3209.472563</span>] x15: <span class="number">0000000000000068</span> x14: <span class="number">0000000000000086</span></span><br><span class="line">[ <span class="number">3209.472564</span>] x13: <span class="number">000000000000004</span>c x12: <span class="number">0000000000000000</span></span><br><span class="line">[ <span class="number">3209.472565</span>] x11: <span class="number">0000000000000000</span> x10: <span class="number">0000000000000007</span></span><br><span class="line">[ <span class="number">3209.472565</span>] x9 : b8e204bfccbe9500 x8 : <span class="number">0000000000000000</span></span><br><span class="line">[ <span class="number">3209.472566</span>] x7 : <span class="number">0000000000000000</span> x6 : ffffffdfffaa6ba9</span><br><span class="line">[ <span class="number">3209.472567</span>] x5 : <span class="number">0000000000000000</span> x4 : <span class="number">0000000000000006</span></span><br><span class="line">[ <span class="number">3209.472568</span>] x3 : <span class="number">0000000000000027</span> x2 : <span class="number">0000000000000007</span></span><br><span class="line">[ <span class="number">3209.472568</span>] x1 : <span class="number">0000000000000007</span> x0 : <span class="number">0000000000000000</span></span><br><span class="line">[ <span class="number">3209.472570</span>] Call trace:</span><br><span class="line">[ <span class="number">3209.472572</span>]  klist_del+<span class="number">0x20</span>/<span class="number">0x88</span></span><br><span class="line">[ <span class="number">3209.472572</span>]  device_del+<span class="number">0xa4</span>/<span class="number">0x4b0</span></span><br><span class="line">[ <span class="number">3209.472574</span>]  device_unregister+<span class="number">0x14</span>/<span class="number">0x30</span></span><br><span class="line">[ <span class="number">3209.472576</span>]  typec_unregister_partner+<span class="number">0x18</span>/<span class="number">0x20</span></span><br><span class="line">[ <span class="number">3209.472579</span>]  handle_disconnect+<span class="number">0x24c</span>/<span class="number">0x2a0</span></span><br><span class="line">[ <span class="number">3209.581559</span>]  disconnect_store+<span class="number">0x58</span>/<span class="number">0x88</span></span><br><span class="line">[ <span class="number">3209.585496</span>]  dev_attr_store+<span class="number">0x18</span>/<span class="number">0x30</span></span><br><span class="line">[ <span class="number">3209.589266</span>]  sysfs_kf_write+<span class="number">0x38</span>/<span class="number">0x50</span></span><br><span class="line">[ <span class="number">3209.593034</span>]  kernfs_fop_write+<span class="number">0x130</span>/<span class="number">0x1d0</span></span><br><span class="line">[ <span class="number">3209.597151</span>]  __vfs_write+<span class="number">0x44</span>/<span class="number">0x148</span></span><br><span class="line">[ <span class="number">3209.600741</span>]  vfs_write+<span class="number">0xe0</span>/<span class="number">0x1a0</span></span><br><span class="line">[ <span class="number">3209.604152</span>]  ksys_write+<span class="number">0x6c</span>/<span class="number">0xd0</span></span><br><span class="line">[ <span class="number">3209.607562</span>]  __arm64_sys_write+<span class="number">0x18</span>/<span class="number">0x20</span></span><br><span class="line">[ <span class="number">3209.611588</span>]  el0_svc_common+<span class="number">0x98</span>/<span class="number">0x160</span></span><br><span class="line">[ <span class="number">3209.615446</span>]  el0_svc_handler+<span class="number">0x64</span>/<span class="number">0x80</span></span><br></pre></td></tr></table></figure>



<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">crash&gt; dis -l klist_del+<span class="number">0x20</span></span><br><span class="line">/data/jenkins/workspace/StationPro_new/sxr2130p_repo/emdoor/LINUX/android/kernel/msm<span class="number">-4.19</span>/lib/klist.c: <span class="number">213</span></span><br><span class="line"><span class="number">0xffffff93127c2cd8</span> &lt;klist_del+<span class="number">32</span>&gt;:      ldr     x22, [x20, #<span class="number">32</span>]</span><br><span class="line"></span><br><span class="line">klist_del(&amp;dev-&gt;p-&gt;knode_parent);</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">klist_del</span><span class="params">(<span class="keyword">struct</span> klist_node *n)</span></span><br><span class="line">&#123;</span><br><span class="line">        klist_put(n, <span class="literal">true</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="keyword">struct</span> klist *<span class="title function_">knode_klist</span><span class="params">(<span class="keyword">struct</span> klist_node *knode)</span></span><br><span class="line">&#123;</span><br><span class="line">        <span class="keyword">return</span> (<span class="keyword">struct</span> klist *)</span><br><span class="line">                ((<span class="type">unsigned</span> <span class="type">long</span>)knode-&gt;n_klist &amp; KNODE_KLIST_MASK);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="number">210</span> <span class="type">static</span> <span class="type">void</span> <span class="title function_">klist_put</span><span class="params">(<span class="keyword">struct</span> klist_node *n, <span class="type">bool</span> kill)</span></span><br><span class="line">211 &#123;</span><br><span class="line"><span class="number">212</span>         <span class="class"><span class="keyword">struct</span> <span class="title">klist</span> *<span class="title">k</span> =</span> knode_klist(n);</span><br><span class="line"><span class="number">213</span>         <span class="type">void</span> (*put)(<span class="keyword">struct</span> klist_node *) = k-&gt;put; <span class="comment">//put：函数指针，用于链表内的节点减少引用计数。</span></span><br><span class="line"><span class="number">214</span> </span><br><span class="line"><span class="number">215</span>         spin_lock(&amp;k-&gt;k_lock);</span><br><span class="line"><span class="number">216</span>         <span class="keyword">if</span> (kill)</span><br><span class="line"><span class="number">217</span>                 knode_kill(n);</span><br><span class="line"><span class="number">218</span>         <span class="keyword">if</span> (!klist_dec_and_del(n))</span><br><span class="line"><span class="number">219</span>                 put = <span class="literal">NULL</span>;</span><br><span class="line"><span class="number">220</span>         spin_unlock(&amp;k-&gt;k_lock);</span><br><span class="line"><span class="number">221</span>         <span class="keyword">if</span> (put)</span><br><span class="line"><span class="number">222</span>                 put(n);</span><br><span class="line"><span class="number">223</span> &#125;</span><br><span class="line"></span><br><span class="line">crash&gt; <span class="class"><span class="keyword">struct</span> <span class="title">klist</span> -<span class="title">xo</span></span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">klist</span> &#123;</span></span><br><span class="line">   [<span class="number">0x0</span>] <span class="type">spinlock_t</span> k_lock;</span><br><span class="line">   [<span class="number">0x8</span>] <span class="class"><span class="keyword">struct</span> <span class="title">list_head</span> <span class="title">k_list</span>;</span></span><br><span class="line">  [<span class="number">0x18</span>] <span class="type">void</span> (*get)(<span class="keyword">struct</span> klist_node *);</span><br><span class="line">  [<span class="number">0x20</span>] <span class="type">void</span> (*put)(<span class="keyword">struct</span> klist_node *);</span><br><span class="line">&#125;</span><br><span class="line">SIZE: <span class="number">0x28</span></span><br><span class="line"></span><br><span class="line">put在klist_init中初始化</span><br><span class="line">put: The put function <span class="keyword">for</span> the embedding <span class="title function_">object</span> <span class="params">(<span class="literal">NULL</span> <span class="keyword">if</span> none)</span></span><br></pre></td></tr></table></figure>

<p>说明klist_node已经被释放，double free导致了空指针访问</p>
<p>下面日志说明&#x2F;sys&#x2F;class&#x2F;typec&#x2F;port0-partner&#x2F;没有power这个组信息</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">[ <span class="number">3209.332078</span>] ------------[ cut here ]------------</span><br><span class="line">[ <span class="number">3209.332082</span>] sysfs group <span class="string">&#x27;power&#x27;</span> not found <span class="keyword">for</span> kobject <span class="string">&#x27;port0-partner&#x27;</span></span><br><span class="line">[ <span class="number">3209.332126</span>] WARNING: CPU: <span class="number">4</span> PID: <span class="number">1</span> at fs/sysfs/group.c:<span class="number">255</span> sysfs_remove_group+<span class="number">0x4c</span>/<span class="number">0xe0</span></span><br><span class="line">[ <span class="number">3209.332128</span>] Modules linked in: wlan(O) machine_dlkm(O) wcd938x_slave_dlkm(O) wcd938x_dlkm(O) wcd9xxx_dlkm(O) mbhc_dlkm(O) tx_macro_dlkm(O) rx_macro_dlkm(O) va_macro_dlkm(O) wsa_macro_dlkm(O) swr_ctrl_dlkm(O) bolero_cdc_dlkm(O) wsa881x_dlkm(O) wcd_core_dlkm(O) stub_dlkm(O) hdmi_dlkm(O) swr_dlkm(O) pinctrl_lpi_dlkm(O) pinctrl_wcd_dlkm(O) usf_dlkm(O) native_dlkm(O) platform_dlkm(O) q6_dlkm(O) adsp_loader_dlkm(O) apr_dlkm(O) snd_event_dlkm(O) q6_notifier_dlkm(O) q6_pdr_dlkm(O) msm_11ad_proxy</span><br><span class="line">[ <span class="number">3209.332178</span>] CPU: <span class="number">4</span> PID: <span class="number">1</span> Comm: init Tainted: G S      W  O      <span class="number">4.19</span><span class="number">.157</span>-perf #<span class="number">1</span></span><br><span class="line">[ <span class="number">3209.332180</span>] Hardware name: Qualcomm Technologies, Inc. kona-xr-overlay <span class="title function_">Standalone</span> <span class="params">(DT)</span></span><br><span class="line">[ 3209.332183] pstate: 60400005 <span class="params">(nZCv daif +PAN -UAO)</span></span><br><span class="line">[ 3209.332186] pc : sysfs_remove_group+0x4c/0xe0</span><br><span class="line">[ 3209.332189] lr : sysfs_remove_group+0x4c/0xe0</span><br><span class="line">[ 3209.332190] sp : ffffff800805bb70</span><br><span class="line">[ 3209.332191] x29: ffffff800805bb70 x28: ffffffde408d9d80</span><br><span class="line">[ 3209.332194] x27: 0000000000000000 x26: 0000000000000000</span><br><span class="line">[ 3209.332196] x25: 0000000056000000 x24: ffffffdfcc8254b8</span><br><span class="line">[ 3209.332198] x23: ffffffdfe99e2b20 x22: ffffffdfcc335008</span><br><span class="line">[ 3209.332199] x21: ffffffdf77aca010 x20: 0000000000000000</span><br><span class="line">[ 3209.332201] x19: ffffff9312be3cd0 x18: 000000000000004c</span><br><span class="line">[ 3209.332203] x17: ffffff9313a66000 x16: 0000000000000068</span><br><span class="line">[ 3209.332204] x15: 0000000000000068 x14: 0000000000000086</span><br><span class="line">[ 3209.332209] x13: 000000000000004c x12: 0000000000000000</span><br><span class="line">[ 3209.332211] x11: 0000000000000000 x10: 0000000000000007</span><br><span class="line">[ 3209.332212] x9 : b8e204bfccbe9500 x8 : b8e204bfccbe9500</span><br><span class="line">[ 3209.332214] x7 : 0000000000000000 x6 : ffffffdfffaa6ba9</span><br><span class="line">[ 3209.332216] x5 : 0000000000000000 x4 : 0000000000000006</span><br><span class="line">[ 3209.332217] x3 : 0000000000000027 x2 : 0000000000000007</span><br><span class="line">[ 3209.332219] x1 : 0000000000000007 x0 : 0000000000000039</span><br><span class="line">[ 3209.332223] Call trace:</span><br><span class="line">[ 3209.332227]  sysfs_remove_group+0x4c/0xe0</span><br><span class="line">[ 3209.332234]  dpm_sysfs_remove+0x64/0x70</span><br><span class="line">[ 3209.332238]  device_del+0x94/0x4b0</span><br><span class="line">[ 3209.332240]  device_unregister+0x14/0x30</span><br><span class="line">[ 3209.332247]  typec_unregister_partner+0x18/0x20</span><br><span class="line">[ 3209.332249]  handle_disconnect+0x24c/0x2a0</span><br><span class="line">[ 3209.332250]  disconnect_store+0x58/0x88</span><br><span class="line">[ 3209.332252]  dev_attr_store+0x18/0x30</span><br><span class="line">[ 3209.332253]  sysfs_kf_write+0x38/0x50</span><br><span class="line">[ 3209.332255]  kernfs_fop_write+0x130/0x1d0</span><br><span class="line">[ 3209.332260]  __vfs_write+0x44/0x148</span><br><span class="line">[ 3209.332261]  vfs_write+0xe0/0x1a0</span><br><span class="line">[ 3209.332262]  ksys_write+0x6c/0xd0</span><br><span class="line">[ 3209.332263]  __arm64_sys_write+0x18/0x20</span><br><span class="line">[ 3209.332268]  el0_svc_common+0x98/0x160</span><br><span class="line">[ 3209.332270]  el0_svc_handler+0x64/0x80</span><br><span class="line">[ 3209.332271]  el0_svc+0x8/0x380</span><br><span class="line">[ 3209.332272] ---[ end trace c8d1c26a5a3e68b1 ]---</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>本地复现，插上mac充电器后一直震动，并且logcat一直刷以下日志，看上去是收到uevent事件，反复add,remove</p>
<img src="C:\Users\rokid\AppData\Roaming\Typora\typora-user-images\image-20231117145408186.png" alt="image-20231117145408186" style="zoom:150%;" />



<p>华为typec充电器</p>
<img src="C:\Users\rokid\AppData\Roaming\Typora\typora-user-images\image-20231117154224970.png" alt="image-20231117154224970" style="zoom:200%;" />



<p>mac充电器</p>
<p><img src="C:\Users\rokid\AppData\Roaming\Typora\typora-user-images\image-20231117154257776.png" alt="image-20231117154257776"></p>
<p>另一个crash</p>
<p>日志如下：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">[  <span class="number">913.683162</span>] Unable to handle kernel <span class="literal">NULL</span> pointer dereference at virtual address <span class="number">0000000000000070</span></span><br><span class="line">[  <span class="number">913.719414</span>] Mem <span class="built_in">abort</span> info:[  <span class="number">913.722622</span>]   ESR = <span class="number">0x96000005</span></span><br><span class="line">[  <span class="number">913.725886</span>]   Exception class = DABT (current EL), IL = <span class="number">32</span> bits</span><br><span class="line">[  <span class="number">913.732107</span>]   SET = <span class="number">0</span>, FnV = <span class="number">0</span></span><br><span class="line">[  <span class="number">913.735294</span>]   EA = <span class="number">0</span>, S1PTW = <span class="number">0</span> </span><br><span class="line">[  <span class="number">913.738608</span>] Data <span class="built_in">abort</span> info:</span><br><span class="line">[  <span class="number">913.741712</span>]   ISV = <span class="number">0</span>, ISS = <span class="number">0x00000005</span></span><br><span class="line">[  <span class="number">913.745756</span>]   CM = <span class="number">0</span>, WnR = <span class="number">0</span> </span><br><span class="line">[  <span class="number">913.748943</span>] user pgtable: <span class="number">4</span>k pages, <span class="number">39</span>-bit VAs, pgdp = <span class="number">0000000054553f</span>c4</span><br><span class="line">[  <span class="number">913.755806</span>] [<span class="number">0000000000000070</span>] pgd=<span class="number">0000000000000000</span>, pud=<span class="number">0000000000000000</span></span><br><span class="line">[  <span class="number">913.762939</span>] Internal error: Oops: <span class="number">96000005</span> [#<span class="number">1</span>] PREEMPT SMP</span><br><span class="line">[  <span class="number">913.768679</span>] Modules linked in: wlan(O) machine_dlkm(O) wcd938x_slave_dlkm(O) wcd938x_dlkm(O) wcd9xxx_dlkm(O) mbhc_dlkm(O) tx_macro_dlkm(O) rx_macro_dlkm(O) va_macro_dlkm(O) wsa_macro_dlkm(O) swr_ctrl_dlkm(O) bolero_cdc_dlkm(O) wsa881x_dlkm(O) wcd_core_dlkm(O) stub_dlkm(O) hdmi_dlkm(O) swr_dlkm(O) pinctrl_lpi_dlkm(O) pinctrl_wcd_dlkm(O) usf_dlkm(O) native_dlkm(O) platform_dlkm(O) q6_dlkm(O) adsp_loader_dlkm(O) apr_dlkm(O) snd_event_dlkm(O) q6_notifier_dlkm(O) q6_pdr_dlkm(O) msm_11ad_proxy[  <span class="number">913.812968</span>] Process init (pid: <span class="number">1</span>, <span class="built_in">stack</span> limit = <span class="number">0x000000008e0451e0</span>)</span><br><span class="line">[  <span class="number">913.819426</span>] CPU: <span class="number">5</span> PID: <span class="number">1</span> Comm: init Tainted: G S      W  O      <span class="number">4.19</span><span class="number">.157</span>-perf #<span class="number">1</span>[  <span class="number">913.827125</span>] Hardware name: Qualcomm Technologies, Inc. kona-xr-overlay Standalone (DT)[  <span class="number">913.868118</span>] aw210xx_led <span class="number">1</span><span class="number">-0020</span>: usb: <span class="number">0</span>, pc_port: <span class="number">0</span></span><br><span class="line">[  <span class="number">913.938910</span>] usbpd usbpd0: Type-C Source (high - <span class="number">3.0</span>A) connected</span><br><span class="line">[  <span class="number">914.001246</span>] pstate: <span class="number">60400005</span> (nZCv daif +PAN -UAO)</span><br><span class="line">[  <span class="number">914.001260</span>] pc : kernfs_find_ns+<span class="number">0x10</span>/<span class="number">0x148</span></span><br><span class="line">[  <span class="number">914.001262</span>] lr : kernfs_find_and_get_ns+<span class="number">0x38</span>/<span class="number">0x88</span></span><br><span class="line">[  <span class="number">914.001262</span>] sp : ffffff800805bb10</span><br><span class="line">[  <span class="number">914.001263</span>] x29: ffffff800805bb10 x28: ffffffde008dc9c0 [  <span class="number">914.001264</span>] x27: <span class="number">0000000000000000</span> x26: <span class="number">0000000000000000</span></span><br><span class="line">[  <span class="number">914.001265</span>] x25: <span class="number">0000000056000000</span> x24: ffffffdf8c80dcb8 [  <span class="number">914.001265</span>] x23: ffffffded84ca520 x22: ffffffdf8c80b008 </span><br><span class="line">[  <span class="number">914.001266</span>] x21: <span class="number">0000000000000000</span> x20: ffffff9fb5de3848  </span><br><span class="line">[  <span class="number">914.001267</span>] x19: <span class="number">0000000000000000</span> x18: <span class="number">0000000005f</span>5e100</span><br><span class="line">[  <span class="number">914.001268</span>] x17: <span class="number">00000000002f</span>29cd x16: <span class="number">0000000000000001</span>  </span><br><span class="line">[  <span class="number">914.001268</span>] x15: fffffffffee3c95c x14: <span class="number">0000000000000010</span> [  <span class="number">914.001269</span>] x13: ffffff9fb4604e98 x12: <span class="number">0000000000000028</span> </span><br><span class="line">[  <span class="number">914.001270</span>] x11: <span class="number">0000000000000072</span> x10: <span class="number">00000000243f</span>d918 [  <span class="number">914.001271</span>] x9 : <span class="number">00000000243f</span>d916 x8 : ffffff9fb6a5b4b0 </span><br><span class="line">[  <span class="number">914.001271</span>] x7 : fefefefefefefefe x6 : <span class="number">0000000000808080</span> [  <span class="number">914.001272</span>] x5 : <span class="number">0000000000000000</span> x4 : ffffffffffffffff </span><br><span class="line">[  <span class="number">914.001273</span>] x3 : <span class="number">0000007265776f</span>70 x2 : <span class="number">0000000000000000</span> [  <span class="number">914.001273</span>] x1 : ffffff9fb5de3848 x0 : <span class="number">0000000000000000</span> </span><br><span class="line">[  <span class="number">914.001276</span>] Call trace:</span><br><span class="line">[  <span class="number">914.001278</span>]  kernfs_find_ns+<span class="number">0x10</span>/<span class="number">0x148</span></span><br><span class="line">[  <span class="number">914.001279</span>]  kernfs_find_and_get_ns+<span class="number">0x38</span>/<span class="number">0x88</span></span><br><span class="line">[  <span class="number">914.001282</span>]  sysfs_remove_group+<span class="number">0x30</span>/<span class="number">0xe0</span></span><br><span class="line">[  <span class="number">914.001287</span>]  dpm_sysfs_remove+<span class="number">0x64</span>/<span class="number">0x70</span></span><br><span class="line">[  <span class="number">914.001290</span>]  device_del+<span class="number">0x94</span>/<span class="number">0x4b0</span></span><br><span class="line">[  <span class="number">914.001290</span>]  device_unregister+<span class="number">0x14</span>/<span class="number">0x30</span></span><br><span class="line">[  <span class="number">914.001295</span>]  typec_unregister_partner+<span class="number">0x18</span>/<span class="number">0x20</span></span><br><span class="line">[  <span class="number">914.001297</span>]  handle_disconnect+<span class="number">0x24c</span>/<span class="number">0x2a0</span></span><br><span class="line">[  <span class="number">914.001297</span>]  disconnect_store+<span class="number">0x58</span>/<span class="number">0x88</span></span><br><span class="line">[  <span class="number">914.001299</span>]  dev_attr_store+<span class="number">0x18</span>/<span class="number">0x30</span></span><br><span class="line">[  <span class="number">914.001300</span>]  sysfs_kf_write+<span class="number">0x38</span>/<span class="number">0x50</span></span><br><span class="line">[  <span class="number">914.001301</span>]  kernfs_fop_write+<span class="number">0x130</span>/<span class="number">0x1d0</span></span><br><span class="line">[  <span class="number">914.001305</span>]  __vfs_write+<span class="number">0x44</span>/<span class="number">0x148</span></span><br><span class="line">[  <span class="number">914.001305</span>]  vfs_write+<span class="number">0xe0</span>/<span class="number">0x1a0</span></span><br><span class="line">[  <span class="number">914.001306</span>]  ksys_write+<span class="number">0x6c</span>/<span class="number">0xd0</span></span><br><span class="line">[  <span class="number">914.001307</span>]  __arm64_sys_write+<span class="number">0x18</span>/<span class="number">0x20</span></span><br><span class="line">[  <span class="number">914.001312</span>]  el0_svc_common+<span class="number">0x98</span>/<span class="number">0x160</span></span><br><span class="line">[  <span class="number">914.001313</span>]  el0_svc_handler+<span class="number">0x64</span>/<span class="number">0x80</span></span><br><span class="line">[  <span class="number">914.001315</span>]  el0_svc+<span class="number">0x8</span>/<span class="number">0x380</span></span><br><span class="line">[  <span class="number">914.001317</span>] Code: a9bd7bfd a90157f6 <span class="number">910003f</span>d a9024ff4 (<span class="number">7940e008</span>)</span><br></pre></td></tr></table></figure>



<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">crash&gt; </span><span class="language-bash">dis -l kernfs_find_ns+0x10</span></span><br><span class="line">/data/jenkins/workspace/StationPro_new/sxr2130p_repo/emdoor/LINUX/android/kernel/msm-4.19/include/linux/kernfs.h: 315</span><br></pre></td></tr></table></figure>



<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">static</span> <span class="keyword">inline</span> <span class="type">bool</span> <span class="title function_">kernfs_ns_enabled</span><span class="params">(<span class="keyword">struct</span> kernfs_node *kn)</span></span><br><span class="line">&#123;</span><br><span class="line">        <span class="keyword">return</span> kn-&gt;flags &amp; KERNFS_NS; <span class="comment">//空指针访问</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">crash&gt; <span class="class"><span class="keyword">struct</span> <span class="title">kernfs_node</span> -<span class="title">xo</span></span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">kernfs_node</span> &#123;</span></span><br><span class="line">   [<span class="number">0x0</span>] <span class="type">atomic_t</span> count;</span><br><span class="line">   [<span class="number">0x4</span>] <span class="type">atomic_t</span> active;</span><br><span class="line">   [<span class="number">0x8</span>] <span class="class"><span class="keyword">struct</span> <span class="title">kernfs_node</span> *<span class="title">parent</span>;</span></span><br><span class="line">  [<span class="number">0x10</span>] <span class="type">const</span> <span class="type">char</span> *name;</span><br><span class="line">  [<span class="number">0x18</span>] <span class="class"><span class="keyword">struct</span> <span class="title">rb_node</span> <span class="title">rb</span>;</span></span><br><span class="line">  [<span class="number">0x30</span>] <span class="type">const</span> <span class="type">void</span> *ns;</span><br><span class="line">  [<span class="number">0x38</span>] <span class="type">unsigned</span> <span class="type">int</span> hash;</span><br><span class="line">         <span class="class"><span class="keyword">union</span> &#123;</span></span><br><span class="line">  [<span class="number">0x40</span>]     <span class="class"><span class="keyword">struct</span> <span class="title">kernfs_elem_dir</span> <span class="title">dir</span>;</span></span><br><span class="line">  [<span class="number">0x40</span>]     <span class="class"><span class="keyword">struct</span> <span class="title">kernfs_elem_symlink</span> <span class="title">symlink</span>;</span></span><br><span class="line">  [<span class="number">0x40</span>]     <span class="class"><span class="keyword">struct</span> <span class="title">kernfs_elem_attr</span> <span class="title">attr</span>;</span></span><br><span class="line">         &#125;;</span><br><span class="line">  [<span class="number">0x60</span>] <span class="type">void</span> *priv;</span><br><span class="line">  [<span class="number">0x68</span>] <span class="class"><span class="keyword">union</span> <span class="title">kernfs_node_id</span> <span class="title">id</span>;</span></span><br><span class="line">  [<span class="number">0x70</span>] <span class="type">unsigned</span> <span class="type">short</span> flags; <span class="comment">//called</span></span><br><span class="line">  [<span class="number">0x72</span>] <span class="type">umode_t</span> mode;</span><br><span class="line">  [<span class="number">0x78</span>] <span class="class"><span class="keyword">struct</span> <span class="title">kernfs_iattrs</span> *<span class="title">iattr</span>;</span></span><br><span class="line">&#125;</span><br><span class="line">SIZE: <span class="number">0x80</span></span><br></pre></td></tr></table></figure>



<p>说明kernfs_node为null</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">sysfs_remove_group</span><span class="params">(<span class="keyword">struct</span> kobject *kobj,</span></span><br><span class="line"><span class="params">			<span class="type">const</span> <span class="keyword">struct</span> attribute_group *grp)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">kernfs_node</span> *<span class="title">parent</span> =</span> kobj-&gt;sd;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">kernfs_node</span> *<span class="title">kn</span>;</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (grp-&gt;name) &#123;</span><br><span class="line">		kn = kernfs_find_and_get(parent, grp-&gt;name);</span><br><span class="line">		<span class="keyword">if</span> (!kn) &#123;</span><br><span class="line">			WARN(!kn, KERN_WARNING</span><br><span class="line">			     <span class="string">&quot;sysfs group &#x27;%s&#x27; not found for kobject &#x27;%s&#x27;\n&quot;</span>,</span><br><span class="line">			     grp-&gt;name, kobject_name(kobj));</span><br><span class="line">			<span class="keyword">return</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		kn = parent;</span><br><span class="line">		kernfs_get(kn);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	remove_files(kn, grp);</span><br><span class="line">	<span class="keyword">if</span> (grp-&gt;name)</span><br><span class="line">		kernfs_remove(kn);</span><br><span class="line"></span><br><span class="line">	kernfs_put(kn);</span><br><span class="line">&#125;</span><br><span class="line">EXPORT_SYMBOL_GPL(sysfs_remove_group);</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="keyword">inline</span> <span class="keyword">struct</span> kernfs_node *</span><br><span class="line"><span class="title function_">kernfs_find_and_get</span><span class="params">(<span class="keyword">struct</span> kernfs_node *kn, <span class="type">const</span> <span class="type">char</span> *name)</span></span><br><span class="line">&#123;</span><br><span class="line">        <span class="keyword">return</span> kernfs_find_and_get_ns(kn, name, <span class="literal">NULL</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">kernfs_find_and_get_ns</span><br><span class="line">	kn = kernfs_find_ns(parent, name, ns);</span><br><span class="line">		<span class="type">bool</span> has_ns = kernfs_ns_enabled(parent);</span><br></pre></td></tr></table></figure>


        
        <br />
        <div id="comment-container">
        </div>
        <div id="disqus_thread"></div>
        <div id="lv-container"></div>
        <div class="giscus"></div>
    </div>
</div>

    </div>
</div>


<footer class="footer">
    <ul class="list-inline text-center">
        
        

        

        

        

        

    </ul>
    
    <p>
        <span id="busuanzi_container_site_pv">
            <span id="busuanzi_value_site_pv"></span>PV
        </span>
        <span id="busuanzi_container_site_uv">
            <span id="busuanzi_value_site_uv"></span>UV
        </span>
        Created By <a target="_blank" rel="noopener" href="https://hexo.io/">Hexo</a>  Theme <a target="_blank" rel="noopener" href="https://github.com/aircloud/hexo-theme-aircloud">AirCloud</a></p>
</footer>




</body>

<script>
    // We expose some of the variables needed by the front end
    window.hexo_search_path = ""
    window.hexo_root = "/"
    window.isPost = true
</script>
<script src="https://cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script>

<script src="/js/index.js"></script>

<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>






</html>
